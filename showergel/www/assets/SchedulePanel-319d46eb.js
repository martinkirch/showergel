import{s as D,l as b,r as u,o as i,a as c,d as e,w as h,h as g,F as f,e as y,t as _,j as S,k as U,u as $,x as B,v as V,g as k,f as M,n as T,y as E}from"./index-5b2b3b07.js";import{n as w}from"./notifications-77da6d3c.js";import{f as I,L}from"./vue3-datepicker-0bbd936d.js";const x=D("schedule",{state:()=>({events:{},loading:!1}),getters:{count(){return this.events.length},eventById:a=>o=>a.events[o]},actions:{async getSchedule(){try{this.loading=!0;const a=await b.get("/schedule");this.$patch({events:a.data,loading:!1})}catch(a){w.error_handler(a)}},async addCartfolder(a,o,r,d){if(a)try{const n=(await b.put("/schedule/cartfolder",{name:a,day_of_week:o,hour:r,minute:d,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone})).data;this.$patch(m=>{m.events[n.when]=n,m.hasChanged=!0})}catch(l){w.error_handler(l)}},async addCommand(a,o){if(a)try{const d=(await b.put("/schedule/command",{command:a,when:o})).data;this.$patch(l=>{l.events[d.when]=d,l.hasChanged=!0})}catch(r){w.error_handler(r)}},async deleteByOccurrence(a){if(a in this.events)try{b.delete("/schedule/"+this.events[a].event_id),this.$patch(o=>{delete o.events[a],o.hasChanged=!0})}catch(o){w.error_handler(o)}}}});const O=e("h3",null,"Schedule a cartfolder",-1),P={class:"field"},A=e("label",{class:"label",for:"cartfolder"},"Cartfolder",-1),F={class:"select"},z=["value"],H={class:"field"},W=e("label",{class:"label",for:"day"},"When",-1),N={class:"field has-addons choosewhen"},R={class:"select"},j=["value"],Z={class:"select"},q=["value"],G={class:"select"},J=["value"],K=e("div",{class:"field"},[e("button",{class:"button is-link",type:"submit"}," Add program ")],-1),Q={__name:"ScheduleCartfolder",props:{cartfolders:Array},setup(a){const o=x(),r=u(0),d=u(0),l=u(0),n=u(""),m=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return(v,s)=>(i(),c("form",{onSubmit:s[4]||(s[4]=U(t=>$(o).addCartfolder(n.value,r.value,d.value,l.value),["prevent"])),class:"box"},[O,e("div",P,[A,e("div",F,[h(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>n.value=t),id:"cartfolder"},[(i(!0),c(f,null,y(a.cartfolders,t=>(i(),c("option",{value:t,key:t},_(t),9,z))),128))],512),[[g,n.value]])])]),e("div",H,[W,e("div",N,[S(" Every "),e("div",R,[h(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>r.value=t),id:"day"},[(i(),c(f,null,y(m,(t,p)=>e("option",{value:p,key:p},_(t),9,j)),64))],512),[[g,r.value]])]),S(" at "),e("div",Z,[h(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>d.value=t),id:"hour"},[(i(),c(f,null,y(24,t=>e("option",{value:t-1,key:t-1},_((t-1).toString().padStart(2,"0")),9,q)),64))],512),[[g,d.value]])]),S(" : "),e("div",G,[h(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>l.value=t),id:"minute"},[(i(),c(f,null,y(60,t=>e("option",{value:t-1,key:t-1},_((t-1).toString().padStart(2,"0")),9,J)),64))],512),[[g,l.value]])])])]),K],32))}},X=e("h3",null,"Schedule a custom command",-1),Y={class:"field"},ee=e("label",{class:"label",for:"template"},"Command template",-1),te={class:"select"},se=e("option",{selected:"",disabled:"",value:""},"Pick a command... ",-1),oe=["value"],ae={class:"field"},ne=e("label",{class:"label",for:"command"},"Command",-1),le={class:"control"},de=e("label",{class:"label",for:"day"},"When",-1),re={class:"field has-addons"},ie={class:"control"},ce={class:"control"},ue=e("div",{class:"field"},[e("button",{class:"button is-link",type:"submit"}," Add event ")],-1),_e={__name:"ScheduleCommand",props:{commands:Array},setup(a){const o=x(),r=u(new Date),d=u(I(new Date,"HH:mm:ss")),l=u(""),n=u("");B(()=>l.value=n.value);function m(){let v=new Date(this.day),s=this.time.split(":"),t=parseInt(s[0]);(t||t===0)&&v.setHours(t);let p=parseInt(s[1]);(p||p===0)&&v.setMinutes(p);let C=parseInt(s[2]);(C||C===0)&&v.setSeconds(C),o.addCommand(this.command,v)}return(v,s)=>(i(),c("form",{onSubmit:s[4]||(s[4]=U(t=>m(),["prevent"])),class:"box"},[X,e("div",Y,[ee,e("div",te,[h(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>n.value=t),id:"template"},[se,(i(!0),c(f,null,y(a.commands,t=>(i(),c("option",{key:t,value:t},_(t),9,oe))),128))],512),[[g,n.value]])])]),e("div",ae,[ne,e("div",le,[h(e("input",{type:"text",class:"input","onUpdate:modelValue":s[1]||(s[1]=t=>l.value=t)},null,512),[[V,l.value]])])]),de,e("div",re,[e("div",ie,[k($(L),{class:"input",placeholder:"2021-01-01",modelValue:r.value,"onUpdate:modelValue":s[2]||(s[2]=t=>r.value=t)},null,8,["modelValue"])]),e("div",ce,[h(e("input",{type:"text",class:"input",size:"8","onUpdate:modelValue":s[3]||(s[3]=t=>d.value=t)},null,512),[[V,d.value]])])]),ue],32))}};const me={class:"when"},he=["onClick"],ve=e("i",{class:"mdi mdi-calendar-remove"},null,-1),pe=[ve],fe={__name:"UpcomingPrograms",setup(a){const o=x();function r(d,l){const n=new Date(l).toLocaleString();confirm(`Really remove "${d}" at ${n}?`)&&o.deleteByOccurrence(l)}return M(()=>{o.getSchedule()}),(d,l)=>(i(),c("div",null,[(i(!0),c(f,null,y($(o).events,n=>(i(),c("div",{key:n.event_id,class:T(`${$(o).loading?"is-loading":""}`)},[e("p",null,[e("span",me,_(new Date(n.when).toLocaleString()),1),S(" "+_(n.type)+" - "+_(n.what)+" ",1),e("button",{class:"button is-danger icon",onClick:m=>r(n.what,n.when),title:"Remove event"},pe,8,he)])],2))),128))]))}},ye={id:"schedule",class:"content my-4"},$e=e("h2",null,"Upcoming programs",-1),we={__name:"SchedulePanel",setup(a){const o=E();return(r,d)=>(i(),c("div",ye,[$e,k(fe),S(" TODO: those forms as modals "),k(Q,{cartfolders:$(o).cartfolders},null,8,["cartfolders"]),k(_e,{commands:$(o).commands},null,8,["commands"])]))}};export{we as default};
